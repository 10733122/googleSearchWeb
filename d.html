<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Document</title>

    <link href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://cdn.bootcss.com/bootstrap-table/1.12.2/bootstrap-table.css" rel="stylesheet">

    <link href="https://cdn.bootcss.com/bootstrap-table/1.12.2/extensions/reorder-rows/bootstrap-table-reorder-rows.css" rel="stylesheet">

</head>

<body>
    <div class="panel-body table-responsive">

        <table id="tabletest">

            <thead>

                <tr>
                    <th data-field="detail">詳細資料欄位</th>
                    <th data-field="vis">顯示/隱藏</th>
                </tr>

            </thead>

            <tbody>
            </tbody>

        </table>

    </div>
    <div>
        <label id="result"></label>
    </div>

    <div id="toolbar" class="btn-group">

        <button id="btn_add" type="button" class="btn btn-info btn-sm rightSize">

            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增

        </button>

        <button id="getdata" type="button" class="btn btn-info btn-sm rightSize">

            获取数据

        </button>

    </div>

    <script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>

    <script src="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="https://cdn.bootcss.com/bootstrap-table/1.12.2/bootstrap-table.js"></script>

    <script src="https://cdn.bootcss.com/bootstrap-table/1.12.2/locale/bootstrap-table-zh-CN.js"></script>

    <script src="https://cdn.bootcss.com/TableDnD/1.0.3/jquery.tablednd.min.js"></script>

    <script src="https://cdn.bootcss.com/bootstrap-table/1.12.2/extensions/reorder-rows/bootstrap-table-reorder-rows.js"></script>

    <script type="text/javascript">

var data = [{
            Id: 0,
            Name: '香蕉',
            StockNum: '100'
        }, {
            Id: 1,
            Name: '波罗蜜',
            StockNum: '200'
        }]; 

        $(document).ready(function () {

            $("#tabletest").bootstrapTable({
                
                reorderableRows: true,

                striped: true,

                search: true,
                height:450,
                toolbar: '#toolbar',
                
                
                useRowAttrFunc: true,
                onClickRow: function(row, element){
                    document.getElementById("result").innerText = JSON.stringify(data[element.index()]);

    }

            });

        });
        
        var visArr = ["true","false","true","true","true"];
        
        $("#btn_add").click(function () {

            for (let i = 0; i < 5; i++) {
                
                if(visArr[i]=="true")
                {
                    $('#tabletest').bootstrapTable('append', { 'detail': i, 'vis': '<div id="container'+i+'" class="container is-active"><div class="circle" onclick="toggle('+i+')"></div></div>' });                      
                }
                else
                {
                    $('#tabletest').bootstrapTable('append', { 'detail': i, 'vis': '<div id="container'+i+'" class="container"><div class="circle" onclick="toggle('+i+')"></div></div>' });     
                }
            }
            $('#tabletest').bootstrapTable('hideColumn', 'detail');
            // $('#tabletest tbody tr').addClass("accordion-toggle");
            // $('#tabletest tbody tr').attr("data-toggle","collapse");
            // $('#tabletest tbody tr').attr("data-target=","#demo2");        
        });

        $("#getdata").click(function () {
        var indexArray ={};

        for (let i = 0; i < $('#tabletest').bootstrapTable('getData').length; i++) {
            var index = $('#tabletest').bootstrapTable('getData')[i].detail;
            alert (index);
        }
        
            //alert(visArr[0]);
        });

    </script>

</body>

</html>
<script>
    function getContainerElementIndex(index){
        document.getElementById('container'+index).classList.toggle('change');
     var nodes = Array.prototype.slice.call( document.getElementsByClassName('container') );
     var liRef = document.getElementsByClassName('change')[0];
     document.getElementById('container'+index).classList.toggle('change');
     return(nodes.indexOf( liRef ));
    }

	function toggle(index,e) {
	 var type = document.getElementById('container'+index).classList.toggle('is-active');
     var containerIndex = getContainerElementIndex(index);
     sleep(300).then(() => { test(index,containerIndex,type); });
     
	}

    function test(index,containerIndex,type){
        
        visArr[index] = String(type);

        if(type)
        {
            
                $('#tabletest').bootstrapTable('updateRow', {
                index: containerIndex,
                row: {
                    'detail': index, 'vis': '<div id="container'+index+'" class="container is-active"><div class="circle" onclick="toggle('+index+')"></div></div>' ,
                }
                });
        }
        else
        {
            $('#tabletest').bootstrapTable('updateRow', { 
                index: containerIndex,
                row: {
                    'detail': index, 'vis': '<div id="container'+index+'" class="container"><div class="circle" onclick="toggle('+index+')"></div></div>' 
                }
                });
        }
    }

    function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
  </script>
<style>

	.container {
	  box-sizing: border-box;
	  width: 70px;
	  height: 40px;
	  padding: 2px;
	  border-radius: 20px;
	  background-color: #6b6b6edb;
	  border: 2px solid #6b6b6edb;
	}
	.circle {
	  position: relative;
	  width: 32px;
	  height: 32px;
	  background-color: white;
	  border-radius: 50%;
	  margin-left: 0;
	  cursor: pointer;
	}
	.is-active.container {
	  background-color: #30DE58;
	  border-color: #30DE58;
	}
	.is-active .circle {
	  background-color: white;
	  margin-left: calc(100% - 32px);
	}

	.container,
  .circle  {
    transition: .3s;
  }

  .is-active.container,
  .is-active .circle {
    transition: all .3s;
  }
  </style>